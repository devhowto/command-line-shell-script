= Bash Redirections
:page-subtitle: Command Line and Shell Script

== Intro

Programs can send output to both STDOUT (file descriptor 1) or STDERR (file descriptor 2).
A well-designed, well-written program will send output to each as appropriate.

For example, `ls` and many (if not all) standard Unix and/or GNU tools send normal messages to STDOUT and error messages to STDERR.
`ls` is one such tool.

When programs send messages to STDERR, they show up in the terminal as if they were standard, normal messages, but that is because shells attach both STDOUT and STDERR to the terminal so we can read messages, be them errors or not.

For example, if we run the command `nope`, and such command (program) cannot be found and run, the shell informs you about it:

[source,shell-session]
----
$ nope
-bash: nope: command not found
----

And we could redirect any error message (FD 2) to a `/dev/null`, a log file, or some other thing.

== Redirect to STDERR

First, let's run a command that doesn't exist and make sure the shell sends the error to `/dev/null`:

[source,shell-session]
----
$ nope
-bash: nope: command not found

$ nope 2> /dev/null
(no output)
----

Run `ls` on a non-existing file, which will cause errors:

[source,shell-session]
----
$ ls ./i-dont-exist
ls: cannot access './i-dont-exist': No such file or directory
----

If we don't want to display the error, but instead send it to the black hole, we then send STDERR (file descriptor 2) to `/dev/null`:

[source,shell-session]
----
$ ls ./i-dont-exist 2> /dev/null
----

== Redirect all messages to /dev/null

Sometimes we just want the terminal to be silent and not pollute the output with noise that may not matter for a given situation and ends up taking our attention away from whatever we are doing.
See here one example:

image::emacs-stdout-stderr-1.png[bash emacs stdout sterr]

[NOTE]
====
I do not advise hiding terminal messages in general, but sometimes it may be desirable for specific situations.
====

I just want to open emacs on my `little-schemer` directory to work on the exercise of the book The Little Schemer, but those messages annoy and distract me.

For bash >= 4, we can simply do:

.redir stderr and stdout to /dev/null, bash >= 4 only
[source,shell-session]
----
$ emacs ./main.scm &> /dev/null &
----

Of course one may prefer to redirect to a text file instead:

.redir stderr and stdout to text file
[source,shell-session]
----
$ emacs ./main.scm &> ./log.txt &
----

Note we used `&>`.
`For bash < 4 or other shells, this is a more portable approach is to use the more standard `2>&1`:

.redir stderr and stdout to /dev/null, portable
[source,shell-session]
----
$ emacs ./defs.scm > /dev/null 2>&1 &
----

Or

.redir stderr and stdout to text file, portable
[source,shell-session]
----
$ emacs ./defs.scm > ./out.txt 2>&1 &
----

Note we first `> /dev/null` then we redirect STDERR to STDOUT with `2>&1`.

In all cases, the final `&` is used to free the prompt as the process then is run in the background.

== References

* link:https://www.gnu.org/software/bash/manual/html_node/Redirections.html[GNU Bash Redirections online manual^].

